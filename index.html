function validateEmail(email) {
    if (!email) return { ok: false, msg: 'Email is required.' };
    email = email.trim();
    if (email.length > 254) return { ok: false, msg: 'Email is too long (max 254 characters).' };

    const atCount = (email.match(/@/g) || []).length;
    if (atCount !== 1) return { ok: false, msg: 'Email must contain a single "@" symbol.' };

    const [local, domain] = email.split('@');
    if (!local) return { ok: false, msg: 'Local part is empty.' };
    if (!domain) return { ok: false, msg: 'Domain part is empty.' };
    if (local.length > 64) return { ok: false, msg: 'Local part is too long (max 64 characters).' };

    // Check if domain has at least one dot
    if (!domain.includes('.')) return { ok: false, msg: 'Domain must contain at least one dot.' };

    // Quick syntax check via regex
    if (!emailPattern.test(email)) {
        // Allow quoted local parts: "..."@domain
        const quotedLocal = /^"(?:\\.|[^"\\])+"@[^\s@]+$/.test(email);
        if (!quotedLocal) return { ok: false, msg: 'Email syntax is invalid.' };
    }

    // Domain checks: labels length and characters, TLD not numeric-only
    const labels = domain.split('.');
    if (labels.length < 2) return { ok: false, msg: 'Domain must have at least two parts.' };
    if (labels.some(l => l.length === 0)) return { ok: false, msg: 'Domain contains empty label (consecutive dots or leading/trailing dot).' };
    for (const label of labels) {
        if (label.length > 63) return { ok: false, msg: 'A domain label is too long (max 63 characters).' };
        if (!/^[A-Za-z0-9-]+$/.test(label)) return { ok: false, msg: 'Domain labels may contain only letters, digits and hyphens.' };
        if (/^-|-$/.test(label)) return { ok: false, msg: 'Domain labels must not start or end with a hyphen.' };
    }
    const tld = labels[labels.length - 1];
    if (/^\d+$/.test(tld)) return { ok: false, msg: 'Top-level domain must not be all numeric.' };

    return { ok: true, msg: 'Email looks valid (syntactically).' };
}
